

# ЁЯза Java рдореЗрдореЛрд░реА рдФрд░ рд░реЗрдлрд╝рд░реЗрдВрд╕ рдХреЙрдиреНрд╕реЗрдкреНрдЯ (Heap vs Stack)

> ЁЯФе **тАЬa рдФрд░ b рджреЛрдиреЛрдВ рдПрдХ рд╣реА рд▓рдбрд╝рдХреА (heap object) рдХреЛ рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВредтАЭ**
> тАФ рдЕрдиреБрд░рд╛рдЧ, рдЬреНрдЮрд╛рди рдкреНрд░рд╛рдкреНрддрд┐ рдХреЗ рдмрд╛рдж ЁЯШО

-----

## ЁЯЪА рдореБрдЦреНрдп рд╡рд┐рдЪрд╛рд░: Java рдХрд╛ 'рджрд┐рд▓ рдФрд░ рджрд┐рдорд╛рдЧ'

| рдореЗрдореЛрд░реА | рд░реЛрд▓ | рдХреНрдпрд╛ рд╕реНрдЯреЛрд░ рд╣реЛрддрд╛ рд╣реИ? |
| :--- | :--- | :--- |
| **Stack** ЁЯза | **рджрд┐рдорд╛рдЧ** | рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ (`int a`, `String s`) рдФрд░ **Heap рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХрд╛ рдкрддрд╛ (Reference)**ред |
| **Heap** тЭдя╕П | **рджрд┐рд▓** | рдЕрд╕рд▓реА **рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕** (`new Object()`) рдпрд╛ **рдРрд░реЗ**ред рдпрд╣ рдХреЙрдорди рдбреЗрдЯрд╛ рд╕реНрдЯреЛрд░ рд╣реИред |

тЮбя╕П **рдирд┐рд╖реНрдХрд░реНрд╖:** рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдирд╣реАрдВ рд░рдЦрддреЗ, рдмрд▓реНрдХрд┐ **рдЙрд╕рдХрд╛ рдкрддрд╛ (Reference)** рд░рдЦрддреЗ рд╣реИрдВ рдЬреЛ Heap рдореЗрдВ рд╕реНрдЯреЛрд░ рд╣реЛрддрд╛ рд╣реИред

-----

## тЪЩя╕П рдореЗрдореЛрд░реА рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдХреЛ рд╡рд┐реЫреБрдЕрд▓рд╛рдЗреЫ рдХрд░реЛ

рдпрд╣рд╛рдВ $\text{int}[]$ $\text{a}$ рдФрд░ $\text{b}$ рдХреЗ рдЙрджрд╛рд╣рд░рдг рд╕реЗ рд╕реНрдЯреЗрдк-рдмрд╛рдп-рд╕реНрдЯреЗрдк рд╕рдордЭрддреЗ рд╣реИрдВ:

### ЁЯУК рд╕реНрдЯреЗрдк 1: $\text{int}[]$ $\text{a}$ рдХреЛ рдмрдирд╛рдирд╛

```java
int[] a = {1, 2, 3};
```

| рдореЗрдореЛрд░реА | рд▓реЛрдХреЗрд╢рди | рдХрдВрдЯреЗрдВрдЯ |
| :--- | :--- | :--- |
| **Stack** | $\text{a}$ | $\rightarrow$ $\mathbf{0x100}$ (Reference) |
| **Heap** | $\mathbf{0x100}$ | $\mathbf{[1, 2, 3]}$ |

тЮбя╕П **рд░рд┐рдЬрд▓реНрдЯ:** $\text{Heap}$ рдореЗрдВ $\text{[1, 2, 3]}$ рдирд╛рдо рдХрд╛ рдПрдХ рдирдпрд╛ рдРрд░реЗ рдмрдирд╛, рдФрд░ $\text{a}$ рдХреЗ рдкрд╛рд╕ рдЙрд╕рдХрд╛ **рдкрддрд╛ ($\mathbf{0x100}$)** рдЪрд▓рд╛ рдЧрдпрд╛ред

-----

### ЁЯУК рд╕реНрдЯреЗрдк 2: $\text{b}$ рдХреЛ $\text{a}$ рдХрд╛ $\text{Reference}$ рджреЗрдирд╛

```java
int[] b = a;
```

| рдореЗрдореЛрд░реА | рд▓реЛрдХреЗрд╢рди | рдХрдВрдЯреЗрдВрдЯ |
| :--- | :--- | :--- |
| **Stack** | $\text{a}$ | $\rightarrow$ $\mathbf{0x100}$ |
| **Stack** | $\text{b}$ | $\rightarrow$ $\mathbf{0x100}$ |
| **Heap** | $\mathbf{0x100}$ | $\mathbf{[1, 2, 3]}$ |

тЬЕ **рд░рд┐рдЬрд▓реНрдЯ:** рдЕрдм $\text{a}$ рдФрд░ $\text{b}$ рджреЛрдиреЛрдВ **рдПрдХ рд╣реА рдРрд░реЗ рдХреЛ рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВ (Shared Reference\!)**ред рдпрд╛рдиреА рджреЛрдиреЛрдВ рдХреЗ рдкрд╛рд╕ $\mathbf{0x100}$ рдХрд╛ $\text{Address}$ рд╣реИред

-----

### ЁЯУК рд╕реНрдЯреЗрдк 3: $\text{b}$ рд╕реЗ $\text{Shared}$ $\text{Object}$ рдореЗрдВ рдмрджрд▓рд╛рд╡ рдХрд░рдирд╛

```java
b[0] = 99; // 0x100 рдкрд░ рдмрджрд▓рд╛рд╡ рд╣реЛрдЧрд╛
```

| рдореЗрдореЛрд░реА | рд▓реЛрдХреЗрд╢рди | рдХрдВрдЯреЗрдВрдЯ |
| :--- | :--- | :--- |
| **Stack** | $\text{a}$ | $\rightarrow$ $\mathbf{0x100}$ |
| **Stack** | $\text{b}$ | $\rightarrow$ $\mathbf{0x100}$ |
| **Heap** | $\mathbf{0x100}$ | $\mathbf{[99, 2, 3]}$ |

тЮбя╕П **рд░рд┐рдЬрд▓реНрдЯ:** рдХреНрдпреЛрдВрдХрд┐ рджреЛрдиреЛрдВ рдПрдХ рд╣реА $\text{Object}$ рдХреЛ рджреЗрдЦ рд░рд╣реЗ рдереЗ, рдЗрд╕рд▓рд┐рдП $\text{a[0]}$ рднреА рдЕрдм $\mathbf{99}$ рд╣реЛ рдЧрдпрд╛ред

-----

### ЁЯУК рд╕реНрдЯреЗрдк 4: $\text{b}$ рдХреЛ $\text{New}$ $\text{Object}$ рджреЗрдирд╛

```java
b = new int[]{5, 6, 7}; // b рдХреЛ рдирдпрд╛ Reference рдорд┐рд▓рд╛
```

| рдореЗрдореЛрд░реА | рд▓реЛрдХреЗрд╢рди | рдХрдВрдЯреЗрдВрдЯ |
| :--- | :--- | :--- |
| **Stack** | $\text{a}$ | $\rightarrow$ $\mathbf{0x100}$ |
| **Stack** | $\text{b}$ | $\rightarrow$ $\mathbf{0x200}$ (New Reference\!) |
| **Heap** | $\mathbf{0x100}$ | $\mathbf{[99, 2, 3]}$ |
| **Heap** | $\mathbf{0x200}$ | $\mathbf{[5, 6, 7]}$ |

тЮбя╕П **рд░рд┐рдЬрд▓реНрдЯ:** рдЕрдм $\text{b}$ рдПрдХ **рдирдП $\text{Array}$ ($\mathbf{0x200}$)** рдХреЛ $\text{Point}$ рдХрд░ рд░рд╣рд╛ рд╣реИред $\text{a}$ рдЕрднреА рднреА $\mathbf{0x100}$ рдкрд░ рд╣реИред рдЗрд╕рд▓рд┐рдП $\text{b}$ рдореЗрдВ рдХрд┐рдП рдЧрдП рдмрджрд▓рд╛рд╡ $\text{a}$ рдкрд░ рдЕрд╕рд░ рдирд╣реАрдВ рдбрд╛рд▓реЗрдВрдЧреЗред

-----

## ЁЯТб $\text{Code}$ $\text{Recap}$

```java
int[] a = {1, 2, 3}; // a -> 0x100
int[] b = a;        // b -> 0x100
b[0] = 99;          // 0x100 рдкрд░ рдмрджрд▓рд╛рд╡

System.out.println(a[0]); // Output: 99

b = new int[]{5, 6, 7}; // b рдЕрдм 0x200 рдкрд░ рдкреЙрдЗрдВрдЯ рдХрд░ рд░рд╣рд╛ рд╣реИ
// b рдЕрдм a рд╕реЗ рдЕрд▓рдЧ рд╣реЛ рдЧрдпрд╛ рд╣реИ

System.out.println(a[0]); // Output: 99 (a рдкрд░ рдХреЛрдИ рдЕрд╕рд░ рдирд╣реАрдВ рдкрдбрд╝рд╛)
```

-----

## ЁЯза рдорд╕реНрдд $\text{Analogy}$ ЁЯШЖ

| $\text{Concept}$ | $\text{Analogy}$ |
| :--- | :--- |
| **$\text{Heap}$ $\text{Object}$** | **рд▓рдбрд╝рдХреА ЁЯСйтАНЁЯж░** (рдЕрд╕рд▓реА рдЪреАреЫ) |
| **$\text{a}$ рдФрд░ $\text{b}$** | **рджреЛ рджреЛрд╕реНрдд ($\text{References}$)** |
| `b = a;` | $\rightarrow$ рджреЛрдиреЛрдВ рдПрдХ рд╣реА рд▓рдбрд╝рдХреА рдХреЛ рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВ ЁЯШЬ |
| `b = new int[]{...};` | $\rightarrow$ $\text{b}$ рдиреЗ рдЕрдм рджреВрд╕рд░реА рд▓рдбрд╝рдХреА рджреЗрдЦ рд▓реА тЭдя╕П |

-----

## тЬЕ $\text{Final}$ $\text{Summary}$

| рдХреНрд░рд┐рдпрд╛ | рдХреНрдпрд╛ рджреЛрдиреЛрдВ рдПрдХ рд╣реА рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рджреЗрдЦ рд░рд╣реЗ рд╣реИрдВ? | рдХреНрдпрд╛ $\text{a}$ рдФрд░ $\text{b}$ рджреЛрдиреЛрдВ рдкрд░ рдЕрд╕рд░ рд╣реЛрдЧрд╛? |
| :--- | :--- | :--- |
| `b = a;` | тЬЕ рд╣рд╛рдБ | тЬЕ рд╣рд╛рдБ |
| `b = new int[]{...};` | тЭМ рдирд╣реАрдВ | тЭМ рдирд╣реАрдВ |

-----
